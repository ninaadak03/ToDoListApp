<!-- src/app/components/tasks/task-form/task-form.component.html -->

<div class="modal-overlay" (click)="onClose()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ task ? 'Edit Task' : 'Create New Task' }}</h3>
      <button class="btn-close" (click)="onClose()">Ã—</button>
    </div>

    <form #taskForm="ngForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="title">Title</label>
        <input 
          type="text" 
          id="title" 
          name="title"
          [(ngModel)]="formData.title"
          required
          minlength="3"
          #title="ngModel"
          placeholder="Enter task title"
          [disabled]="isLoading">
        <div class="error-message" *ngIf="title.invalid && title.touched">
          <small *ngIf="title.errors?.['required']">Title is required</small>
          <small *ngIf="title.errors?.['minlength']">Title must be at least 3 characters</small>
        </div>
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea 
          id="description" 
          name="description"
          [(ngModel)]="formData.description"
          required
          rows="4"
          #description="ngModel"
          placeholder="Enter task description"
          [disabled]="isLoading"></textarea>
        <div class="error-message" *ngIf="description.invalid && description.touched">
          <small *ngIf="description.errors?.['required']">Description is required</small>
        </div>
      </div>

      <div class="form-group">
        <label for="category">Category</label>
        <select 
          id="category" 
          name="category"
          [(ngModel)]="formData.categoryId"
          required
          #category="ngModel"
          [disabled]="isLoading">
          <option [value]="0">Select a category</option>
          <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
        </select>
        <div class="error-message" *ngIf="category.invalid && category.touched">
          <small *ngIf="category.errors?.['required']">Category is required</small>
        </div>
      </div>

      <div class="form-group" *ngIf="task">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            name="isCompleted"
            [(ngModel)]="formData.isCompleted"
            [disabled]="isLoading">
          <span>Mark as completed</span>
        </label>
      </div>

      <div class="error-message" *ngIf="errorMessage">
        <p>{{ errorMessage }}</p>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="onClose()" [disabled]="isLoading">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="taskForm.invalid || isLoading">
          <span *ngIf="!isLoading">{{ task ? 'Update' : 'Create' }}</span>
          <span *ngIf="isLoading">Saving...</span>
        </button>
      </div>
    </form>
  </div>
</div>
